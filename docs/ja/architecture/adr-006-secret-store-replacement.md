# ADR 006:シークレットストレージの交換

## 変更ログ

-2019年7月29日:最初のドラフト
-2019年9月11日:作業が開始されました
-11月4日:CosmosSDKの変更がマージ
-11月18日:ガイアの変更がマージ

## 環境

現在、Cosmos SDKアプリケーションのCLIディレクトリには、ユーザーのホームディレクトリにあるプレーンテキストデータベースに主要な資料とメタデータが格納されています。キーマテリアルはパスワードで暗号化され、bcryptハッシュアルゴリズムで保護されています。メタデータ(アドレス、公開鍵、鍵ストレージの詳細など)はプレーンテキストで提供されます。

これは多くの理由で望ましくありません。おそらく最大の理由は、主要な資料とメタデータのセキュリティ保護が不十分なことです。プレーンテキストが漏洩すると、攻撃者は、特権を実行せずに依存関係を破棄するなど、さまざまな手法で特定のコンピューター制御キーを監視できます。特定のユーザー/コンピューターに対するより標的を絞った攻撃が続く可能性があります。

最新のデスクトップコンピューターオペレーティングシステム(Ubuntu、Debian、MacOS、Windows)はすべて、アプリケーションが他のすべてのアプリケーションから分離された情報を保存し、データにアクセスするためにパスワードを必要とするように設計された組み込みのシークレットストレージを提供します。

私たちは、多くの異なるバックエンドに共通の抽象化レイヤーを提供し、ネイティブシークレットストレージを提供しない最小のプラットフォームに合理的なフォールバックを提供するソリューションを探しています。

## 決定

LevelDBに基づく現在のKeybaseバックエンドを99デザインの[Keyring](https://github.com/99designs/keyring)に置き換えることをお勧めします。このアプリケーションは、多くのシークレットストア間で共通の抽象化と統一されたインターフェースを提供するように設計されており、99-designsアプリケーションによってAWSVaultアプリケーションによって使用されます。

これは、ユーザーのマシンに対するマルウェア攻撃から主要なマテリアルとメタデータを保護するための要件を満たしているようです。

## ステータス

受け入れられました

## 結果

### 目的

ユーザーのセキュリティを強化します。

### ネガティブ

ユーザーは手動で移行する必要があります。

サポートされているすべてのバックエンドに対してテストすることは困難です。

Macでローカルにテストを実行するには、パスワードを複数回再入力する必要があります。

### ニュートラル

{中立的な結果}

## 参照する

-#4754シークレットストレージをキーリングシークレットストレージに切り替えます(@poldsamの元のPR)[__ CLOSED__]
-#5029 github.com/99designs/keyring-backed keystore [__ MERGED__]のサポートを追加
-#5097キー移行コマンドの追加[__MERGED__]
-#5180キーリングをサポートするためにディスクキーストアを削除します[_PENDING_REVIEW_]
-cosmos/gaia#164キーリングをサポートするためにディスクキーストアを削除します(gaiaの変更)[_ PENDING_REVIEW_] 